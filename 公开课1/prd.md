# 图片字幕生成器 (Subtitle Stitcher) 产品需求文档 (PRD)

## 1. 项目概述
### 1.1 产品简介
一款纯前端的网页工具，允许用户上传一张图片并输入多行字幕，自动生成一张“电影台词拼接风格”的长图。
生成的图片特点是：保留第一张完整的带字幕底图，后续每一行字幕都使用原图底部的相同切片进行垂直拼接，营造出连续画面的视觉切割感。

### 1.2 目标用户
- 社交媒体创作者（制作电影台词长图、meme 表情包）。
- 需要为静态图片添加叙事性对话的用户。

---

## 2. 功能需求 (Functional Requirements)

### 2.1 核心流程
1. **上传**：用户选择本地图片文件。
2. **配置**：设置字幕样式参数（高度、大小、颜色等）。
3. **输入**：在文本域中输入多行文字，每一行对应生成的长图中的一个切片。
4. **生成**：点击生成按钮，在画布上渲染出拼接长图。
5. **保存**：将生成的长图导出为 PNG/JPG 格式。

### 2.2 详细功能模块

#### 2.2.1 图片上传模块
- **功能**：支持 `<input type="file">` 选择本地图片。
- **显示**：上传后在界面上显示文件名（如截图所示 `61bca1c9...png`），并在下方预览区显示生成的初始效果。
- **限制**：支持常见格式（JPG, PNG, WebP）。

#### 2.2.2 参数设置模块
用户可调整以下参数来控制字幕样式和切片逻辑：

| 参数名称 | 默认值 | 说明 |
| :--- | :--- | :--- |
| **字幕高度 (px)** | 40 | 决定每次截取原图底部的像素高度，也决定了字幕区域的垂直空间。 |
| **字体大小 (px)** | 20 | 字幕文字的字号。 |
| **字体颜色** | #FFFFFF (白) | 包含颜色选择器，支持自定义。 |
| **轮廓颜色** | #000000 (黑) | 文字描边/阴影颜色，增加对比度，确保在复杂背景上可见。 |

#### 2.2.3 文本编辑模块
- **多行文本域**：
    - 用户在此输入字幕内容。
    - **换行逻辑**：每一次换行（Enter）代表一个新的字幕切片。
    - **空行处理**：若某行为空，建议跳过或生成无文字的背景切片（视具体实现而定，建议跳过）。
- **占位符/默认文案**：提供默认的示例文案（如截图中的猫咪对话），方便用户理解功能。

#### 2.2.4 图像生成与预览模块 (核心算法)
这是本工具的核心逻辑，必须严格遵循“切割感”拼接规则：
1. **底图切片逻辑**：
    - 定义 `H` = 字幕高度。
    - **第 1 部分**：完整的原始图片，在底部（距底边一定边距或居中）绘制第 1 行字幕。
    - **第 2 ~ N 部分**：对于文本域中的第 2 行到第 N 行文字，每一行生成一个高度为 `H` 的图片切片。
    - **切片源**：所有切片的图像内容都取自原图**最底部**高度为 `H` 的区域。这意味着背景是完全重复的。
2. **拼接逻辑**：
    - 将 [完整原图] + [切片2] + [切片3] ... + [切片N] 垂直拼接成一张长图。
3. **文字渲染**：
    - 文字需水平居中。
    - 文字需垂直居中于其所在的 `H` 高度区域内（或稍偏下，视视觉重心而定）。
    - 必须应用用户设置的字体大小、颜色和描边。

#### 2.2.5 操作栏
- **生成字幕图片**（按钮）：
    - 点击后触发 Canvas 重新绘制。
    - 样式建议：绿色背景，醒目（参考截图）。
- **保存图片**（按钮）：
    - 点击后触发浏览器下载行为。
    - 文件名建议：`subtitle_export_[timestamp].png`。

---

## 3. 界面与交互设计 (UI/UX)

### 3.1 布局结构
采用简洁的垂直流式布局（参考截图）：
1. **Header**：标题“图片字幕生成器”，黑体加粗，左对齐。
2. **Input Area**：
    - 文件选择器。
    - 参数行：四个参数并排显示（在移动端可自动换行）。
    - 文本域：宽大的多行输入框，高度自适应或固定高度（如 150px）。
3. **Action Area**：两个绿色按钮并排。
4. **Preview Area**：
    - 居中显示生成的长图。
    - 图片宽度自适应容器宽度（`max-width: 100%`），保持长宽比。

### 3.2 视觉风格
- **极简主义**：白底黑字，无多余装饰。
- **控件风格**：
    - 输入框：标准 HTML 边框，带圆角。
    - 按钮：实心绿色（如 `#4CAF50`），白色文字，无边框，圆角。
- **响应式**：
    - 在 PC 端参数一行显示。
    - 在移动端参数自动折行，预览图自动缩放。

---

## 4. 技术栈建议
- **HTML5/CSS3**：构建布局。
- **JavaScript (ES6+)**：逻辑控制。
- **Canvas API**：
    - 用于图像处理、裁剪 (`drawImage` 参数控制 sourceY/sourceHeight)、文字绘制 (`fillText`, `strokeText`) 和最终图片导出 (`toDataURL`).
    - 纯前端实现，无需后端服务，保护用户隐私。

## 5. 待办事项 (Todo)
- [ ] 搭建基础 HTML 结构。
- [ ] 实现 Canvas 拼接算法（核心）。
- [ ] 绑定 UI 参数与 Canvas 渲染逻辑。
- [ ] 实现图片下载功能。
- [ ] 样式美化与移动端适配。
